import{adoptNode as D,call as j,doc as o,domParse as K,forEach as F,listen as v,location as l,preventDefault as P,Promise as a,querySelector as s,querySelectorAll as x,remove as Q,replaceWith as N,TRUE as U,win as q}from"/.js/@classic/js/dom/util.js";var $=500,y,I={},m="cc-route",R="cc-fetching",u=async e=>{let n=new URL(e,l.origin),t=s(m),i=t,T,g,h=[],f,H,p,S=document.documentElement.classList;for(t||d(e);(T=s(m,i))&&(g=i.getAttribute("path"),!!g);)h.push(g),i=T;n.searchParams.set("cc-from",h.join("/")),f=y=a.race([new a(r=>setTimeout(r,$)),H=a.resolve(I[n]?.cloneNode(U)??fetch(n).then(r=>r.redirected?a.reject(u(r.url)):(p=r.headers.get("CC-From"),r.text().then(c=>y==f?K(c):a.reject())))).finally(()=>y=0)]),l.href!=e&&history.pushState(0,"",e),await f||S.add(R);let L=await H,E=s(m,L.body),M=L.title,b={},k=0,w;Q(S,R),E||d(e),i=t;for(w of p?p.split("/"):[])(w!=h[k]||!(i=s(m,i)))&&d(e),k++;i||d(e),M&&(o.title=M),A(o.head,(r,c)=>b[c]=r),A(L.head,(r,c)=>!b[c]&&o.head.append(D(r))),N(i,D(E)),F(x("script",E),W)},d=e=>{throw l.href=e},A=(e,n)=>F(x("link,script",e),(t,i)=>n(t,`${i=t.tagName}:${i=="LINK"?t.href:t.src}`)),W=e=>{let n=o.createElement("script");n.text=e.text,N(e,n)},C=e=>{let n=l.origin;return new URL(e,n).origin==n},B=()=>{let e,n=[v(o.body,"click",t=>!t.ctrlKey&&!t.shiftKey&&(e=t.target)instanceof HTMLAnchorElement&&C(e.href)&&(P(t),u(e.href))),v(o.body,"submit",t=>(e=t.target)instanceof HTMLFormElement&&e.method=="get"&&!t.defaultPrevented&&C(e.action)&&(P(t),u(e.action))),v(q,"popstate",()=>u(l.href))];return()=>n.map(j)};export{B as init};
//# sourceMappingURL=router.js.map
